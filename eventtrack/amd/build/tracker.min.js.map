{"version":3,"sources":["../src/tracker.js"],"names":["userid","irsUrl","irsUser","irsPassword","IRS_URL","IRS_USER","IRS_PASSWORD","USERID","setTabId","postUserAgent","trackIntersection","trackMouseClick","trackMouseMove","trackTextSelection","trackMouseLeave","trackMouseEnter","trackCopy","postViewport","trackPositionsAndViewport","trackBlur","trackFocus","trackQuizInputChange","trackDetailToggle","trackTabLeave","trackContextMenu","trackResize","trackMediaEvents","INTERSECTION_STEPS","postData","data","response","fetch","method","mode","headers","window","btoa","body","JSON","stringify","then","catch","error","console","log","createTrackingEvent","eventName","payloadData","name","timestamp","getTimestamp","payload","url","location","href","tabid","getTabId","Date","now","getElementId","element","id","tabId","sessionStorage","closedLastTab","Math","floor","random","addEventListener","userAgent","navigator","document","mouseLeave","mouseEnter","contextMenu","onclick","event","target","parentA","closest","clickData","getDataAttributes","elementClasses","classList","nodeName","dataset","topic","category","resource","mouseUp","textSelection","getSelection","toString","length","selectionData","text","classes","postTime","callback","entries","forEach","entry","isIntersecting","intersectionData","intersectionRatio","boundingClientRect","intersectionRect","setTimeout","observer","IntersectionObserver","rootMargin","threshold","getScrollTrackables","t","observe","timer","lastTime","positions","onmousemove","e","push","x","pageX","y","pageY","mouseMoveData","getParagraphs","querySelectorAll","getFeedbackElements","getReferences","getMediaElements","postElementPositions","elements","paragraphs","i","box","getBoundingClientRect","top","scrollY","left","scrollX","w","offsetWidth","h","offsetHeight","viewportData","viewport","innerWidth","innerHeight","buffer1","clearTimeout","buffer2","selection","copyData","resize","main","getElementById","ResizeObserver","detailElements","detail","toggleData","open","inputs","inputElement","dataCatChild","parentNode","querySelector","inputData","quizInputId","checked","mediaElement","getEventData","el","currentTime","src","currentSrc","duration","paused","volume","eventData"],"mappings":"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","sourcesContent":["/* eslint-disable no-console */\n/**\n * @package    block_eventtrack\n * @copyright  2020 Daniel Biedermann <biedermann@dipf.de>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nconst MOUSE_MOVE_TRACKING_INTERVAL = 50; // Delay between successive mouse movement samples\nconst MOUSE_MOVE_POSTING_DELAY = 2000; // Delay between successive posts of the mouse movement data\nconst SCROLL_TRACKING_INTERVAL = 333; // Delay between successive scroll samples\nconst RESIZE_TRACKING_INTERVAL = 333; // Delay between successive resizing samples\nconst INTERSECTION_TRACKING_INTERVAL = 500; // Deltay between successive intersection observer tracks\nconst INTERSECTION_STEPS = [0.2, 0.4, 0.6, 0.8, 1.0];\n\nlet IRS_USER = 'user';\nlet IRS_PASSWORD = 'user';\nlet IRS_URL = 'https://tracking.difa.edutec.science/datums';\nlet USERID = \"\";\n\n/**\n * @param {payload} data\n * @return {promise} the response from the server\n */\nexport function postData(data) {\n  const response = fetch(IRS_URL, {\n    method: \"POST\",\n    mode: \"cors\",\n    headers: {\n      \"Content-Type\": \"application/json\",\n      \"Authorization\": \"Basic \" + window.btoa(`${IRS_USER}:${IRS_PASSWORD}`),\n    },\n    body: JSON.stringify(data),\n  })\n    .then((response) => response)\n    // eslint-disable-next-line no-console\n    .catch((error) => console.log(error));\n  return response;\n}\n\n/**\n *\n * @param {string} eventName\n * @param {payload} payloadData\n * @return {eventdata} event data for the IRS\n */\nexport function createTrackingEvent(eventName, payloadData) {\n  return {\n    name: eventName,\n    timestamp: getTimestamp(),\n    payload: {\n      url: window.location.href,\n      userid: USERID,\n      tabid: getTabId(),\n      ...payloadData,\n    },\n  };\n}\n\nconst getTimestamp = () => Date.now();\n\n/**\n * Returns the element id or null. This function exists because if element.id is undefined, it not be added to the JSON\n * thereby potentially causing annoying parsing afterwards. Therefore, we ensure that it the element is always present\n * @param {DOMElement} element\n * @returns {string} The element id if there is one, otherwise null\n */\nconst getElementId = (element) => element.id ? element.id : null;\n\nconst getTabId = () => window.tabId;\n\n/**\n * Sets an Id to identify the tab that is then stored in session storage.\n*/\nfunction setTabId() {\n  if (sessionStorage.tabId && sessionStorage.closedLastTab !== \"2\") {\n    window.tabId = sessionStorage.tabId;\n  } else {\n    sessionStorage.tabId = Math.floor(Math.random() * 1000000000);\n    window.tabId = sessionStorage.tabId;\n  }\n\n  sessionStorage.closedLastTab = '2';\n\n  window.addEventListener(\"unload beforeunload\", () => {\n    sessionStorage.closedLastTab = '1';\n  });\n}\n\n/**\n * Posts the user agent\n * @param {string} userid\n */\nfunction postUserAgent() {\n  const userAgent = navigator.userAgent;\n  const userAgentData = {\n    userAgent,\n  };\n  postData(createTrackingEvent(\"useragent\", userAgentData));\n}\n\n/**\n * Tracks and posts the mouse leave event\n */\nfunction trackMouseLeave() {\n  const mouseLeave = () => {\n    postData(createTrackingEvent(\"mouseleave\", {}));\n  };\n  document.body.addEventListener(\"mouseleave\", mouseLeave);\n}\n\n/**\n * Tracks and posts the mouse enter event\n */\nfunction trackMouseEnter() {\n  const mouseEnter = () => {\n    postData(createTrackingEvent(\"mouseenter\", {}));\n  };\n  document.body.addEventListener(\"mouseenter\", mouseEnter);\n}\n\n/**\n * Tracks whenever the context menu is opened\n */\nfunction trackContextMenu() {\n  const contextMenu = () => {\n    postData(createTrackingEvent(\"contextmenu\", {}));\n  };\n  document.body.addEventListener(\"contextmenu\", contextMenu);\n}\n\n\n/**\n * Tracks and posts the mouse enter event\n */\nfunction trackMouseClick() {\n  document.onclick = (event) => {\n\n    let href = event.target.href ? event.target.href : null;\n    // Check if the clicked element is part of a link\n    if (!href) {\n      let parentA = event.target.closest(\"a\");\n      if (parentA) {\n        href = parentA.href;\n      }\n    }\n\n    const clickData = {\n      ...getDataAttributes(event.target),\n      id: getElementId(event.target),\n      elementClasses: event.target.classList,\n      nodeName: event.target.nodeName,\n      href,\n    };\n    postData(createTrackingEvent(\"click\", clickData));\n  };\n}\n\n/**\n * Returns the data-attributes of interest for an an element\n * @param {DOMElement} element\n * @returns {Object} Object containing the data-attributes\n */\nfunction getDataAttributes(element) {\n  let dataset = {\n    topic: null,\n    category: null,\n    resource: null\n  };\n  if (element.dataset.topic) {\n    dataset.topic = element.dataset.topic;\n  }\n  if (element.dataset.category) {\n    dataset.category = element.dataset.category;\n  }\n  if (element.dataset.resource) {\n    dataset.resource = element.dataset.resource;\n  }\n  return dataset;\n}\n\n/**\n * Tracks and posts whenever a user has text in their clipboard.\n * @param {string} userid\n */\nfunction trackTextSelection() {\n  const mouseUp = (event) => {\n    const textSelection = window.getSelection().toString();\n    if (textSelection.length) {\n      const selectionData = {\n        text: textSelection,\n        element: {\n          ...getDataAttributes(event.target),\n          classes: event.target.classList,\n          id: getElementId(event.target),\n          name: event.target.nodeName,\n        },\n      };\n      postData(createTrackingEvent(\"textselection\", selectionData));\n    }\n  };\n  window.addEventListener(\"mouseup\", mouseUp);\n}\n\n/**\n * Tracks and posts the visibility of elements with the intersection observer API\n * @param {string} userid\n */\nfunction trackIntersection() {\n  const options = {\n    rootMargin: \"0px\",\n    threshold: INTERSECTION_STEPS,\n  };\n  let postTime = true;\n  const callback = (entries) => {\n\n    if (!postTime) {\n      return;\n    }\n    entries.forEach((entry) => {\n      if (entry.isIntersecting) {\n        let intersectionData = {\n          intersectionRatio: entry.intersectionRatio,\n          isIntersecting: entry.isIntersecting,\n          boundingClientRect: entry.boundingClientRect,\n          intersectionRect: entry.intersectionRect,\n          id: getElementId(entry.target),\n          ...getDataAttributes(entry.target)\n        };\n        postData(\n          createTrackingEvent(\"intersection\", intersectionData)\n        );\n      }\n    });\n\n    postTime = false;\n    setTimeout(() => {\n      postTime = true;\n    }, INTERSECTION_TRACKING_INTERVAL);\n  };\n  let observer = new IntersectionObserver(callback, options);\n\n  getScrollTrackables().forEach((t) => observer.observe(t));\n}\n\n/**\n * Tracks and posts the mouse move events\n * Mouse movement tracking intervals are defined with MOVE_MOVE_TRACKING_INTERVAL\n * All mouse movements that are tracked within the MOUSE_MOVE_POSTING_DELAY are batch-sent to the IRS\n */\nfunction trackMouseMove() {\n  let timer = null;\n  let lastTime = 0;\n  let positions = [];\n  document.onmousemove = (e) => {\n    const timestamp = Date.now();\n    if (timestamp - lastTime >= MOUSE_MOVE_TRACKING_INTERVAL) { // Mouse movenets are tracked once every X ms\n      positions.push({\n        timestamp,\n        x: e.pageX,\n        y: e.pageY,\n      });\n      lastTime = timestamp;\n    }\n    if (!timer) {\n      timer = setTimeout(() => {\n        const mouseMoveData = {\n          positions,\n        };\n        postData(createTrackingEvent(\"mousemove\", mouseMoveData));\n        positions = [];\n        timer = null;\n      }, MOUSE_MOVE_POSTING_DELAY);\n    }\n  };\n}\n\nconst getParagraphs = () => document.querySelectorAll(\"[data-category='paragraph']\");\n\nconst getFeedbackElements = () => document.querySelectorAll(\".feedback\");\n\nconst getReferences = () => document.querySelectorAll(\"[data-category='bibliography']\");\n\nconst getMediaElements = () => document.querySelectorAll(\"audio, video\");\n\nconst getScrollTrackables = () => [...getParagraphs(), ...getFeedbackElements(), ...getReferences(), ...getMediaElements()];\n\n/**\n * Tracks the x- and y-position of all the elements that have the data-category=paragraph attribute\n */\nfunction postElementPositions() {\n  const elements = getScrollTrackables();\n  const paragraphs = [];\n\n  for (var i = 0; i < elements.length; i++) {\n    const box = elements[i].getBoundingClientRect();\n    paragraphs.push({\n      ...getDataAttributes(elements[i]),\n      id: getElementId(elements[i]),\n      y: box.top + window.scrollY,\n      x: box.left + window.scrollX,\n      w: elements[i].offsetWidth,\n      h: elements[i].offsetHeight,\n    });\n  }\n  const positionData = {\n    paragraphs,\n  };\n  if (paragraphs.length > 0) {\n    postData(createTrackingEvent(\"positions\", positionData));\n  }\n}\n\nconst postViewport = () => {\n  const viewportData = {\n    viewport: {\n      y: window.scrollY,\n      x: window.scrollX,\n      w: window.innerWidth,\n      h: window.innerHeight,\n    },\n  };\n  postData(createTrackingEvent(\"viewport\", viewportData));\n};\n\n/**\n * Listens to the \"scroll\" and \"resize\" events and posts the updated element positions\n */\nfunction trackPositionsAndViewport() {\n  postElementPositions();\n  postViewport();\n  let buffer1 = null;\n  window.addEventListener(\"resize\", () => {\n    clearTimeout(buffer1);\n    buffer1 = setTimeout(() => {\n      postElementPositions();\n      postViewport();\n    }, RESIZE_TRACKING_INTERVAL);\n  });\n  let buffer2 = null;\n  window.addEventListener(\"scroll\", () => {\n    if (!buffer2) {\n      buffer2 = setTimeout(() => {\n        postViewport();\n        buffer2 = null;\n      }, SCROLL_TRACKING_INTERVAL);\n    }\n  });\n}\n\n/**\n * Listens to the \"copy\" event and posts the data\n */\nfunction trackCopy() {\n  document.addEventListener(\"copy\", (event) => {\n    const selection = window.getSelection();\n    const copyData = {\n      selection: selection.toString(),\n      element: {\n        classes: event.target.classList,\n        id: getElementId(event.target),\n        name: event.target.nodeName,\n      },\n    };\n    postData(createTrackingEvent(\"copy\", copyData));\n  });\n}\n\n/**\n * Tracks the blur event\n */\nfunction trackBlur() {\n  window.addEventListener(\"blur\", () => {\n    const blurData = {};\n    postData(createTrackingEvent(\"blur\", blurData));\n  });\n}\n\n/**\n * Tracks the focus event\n */\nfunction trackFocus() {\n  window.addEventListener(\"focus\", () => {\n    const focusData = {};\n    postData(createTrackingEvent(\"focus\", focusData));\n  });\n}\n\n/**\n * Tracks all resizes of region-main\n */\nfunction trackResize() {\n  const resize = () => {\n    postElementPositions();\n    postViewport();\n  };\n\n  let main = document.getElementById(\"region-main\");\n\n  if (main) {\n    new ResizeObserver(resize).observe(document.getElementById(\"region-main\"));\n  }\n}\n\n/**\n * Tracks the toggling of <detail> elements\n */\nfunction trackDetailToggle() {\n\n  const detailElements = document.querySelectorAll(\"details\");\n  if (detailElements) {\n    detailElements.forEach((detail) => {\n      detail.addEventListener(\"toggle\", (event) => {\n        const toggleData = {\n          open: event.target.open,\n          id: event.target.id,\n          ...getDataAttributes(event.target)\n        };\n        postData(createTrackingEvent(\"detailsToggle\", toggleData));\n\n        setTimeout(() => postElementPositions(), 100);\n      });\n    });\n  }\n\n}\n/**\n * Tracks the toggling of <detail> elements\n * @param {string} userid\n */\nfunction trackQuizInputChange(userid) {\n  let inputs = [...document.querySelectorAll(\"input[type='checkbox']\", \"input[type='radio']\")];\n  inputs.forEach((inputElement) => {\n    inputElement.addEventListener(\"change\", (event) => {\n      // Part of the information that needs to be extracted is NOT IN THE INPUT ELEMENT ITSELF,\n      // but instead in a paragraph further down the tree\n      let dataCatChild = event.target.parentNode.querySelector(\"[data-category='quiz-answer']\");\n      let id = \"\";\n      if (dataCatChild) {\n        id = dataCatChild.id;\n      } else {\n        id = event.target.id;\n      }\n\n      const inputData = {\n        quizInputId: event.target.id,\n        checked: event.target.checked,\n        id,\n        ...getDataAttributes(dataCatChild)\n      };\n      postData(createTrackingEvent(userid, \"quizInputChange\", inputData));\n    });\n  });\n}\n\n/**\n * Sends an event when the \"unload\" event is raised\n */\nfunction trackTabLeave() {\n  window.addEventListener(\"beforeunload\", () => {\n    postData(createTrackingEvent(\"unload\", {}));\n  });\n}\n\n// eslint-disable-next-line require-jsdoc\nfunction trackMediaEvents() {\n  document.querySelectorAll(\"audio, video\").forEach((mediaElement) => {\n\n    let getEventData = (el) => {\n      return {\n        currentTime: el.currentTime,\n        src: el.currentSrc,\n        duration: el.duration,\n        paused: el.paused,\n        volume: el.volume\n      };\n    };\n\n    mediaElement.addEventListener(\"play\", (event) => {\n      let eventData = getEventData(event.target);\n      postData(createTrackingEvent(\"mediaPlay\", eventData));\n    });\n\n    mediaElement.addEventListener(\"pause\", (event) => {\n      let eventData = getEventData(event.target);\n      postData(createTrackingEvent(\"mediaPause\", eventData));\n    });\n\n    mediaElement.addEventListener(\"volumechange\", (event) => {\n      let eventData = getEventData(event.target);\n      postData(createTrackingEvent(\"mediaVolumeChange\", eventData));\n    });\n\n    mediaElement.addEventListener(\"ended\", (event) => {\n      let eventData = getEventData(event.target);\n      postData(createTrackingEvent(\"mediaEnded\", eventData));\n    });\n\n    mediaElement.addEventListener(\"interrupted\", (event) => {\n      let eventData = getEventData(event.target);\n      postData(createTrackingEvent(\"mediaInterrupted\", eventData));\n    });\n\n    mediaElement.addEventListener(\"seeked\", (event) => {\n      let eventData = getEventData(event.target);\n      postData(createTrackingEvent(\"mediaSeeked\", eventData));\n    });\n\n    mediaElement.addEventListener(\"ratechange\", (event) => {\n      let eventData = getEventData(event.target);\n      postData(createTrackingEvent(\"mediaRateChange\", eventData));\n    });\n\n    document.addEventListener(\"webkitfullscreenchange mozfullscreenchange fullscreenchange\", (event) => {\n      let eventData = getEventData(event.target);\n      postData(createTrackingEvent(\"mediaFullscreenChange\", eventData));\n    });\n\n    mediaElement.addEventListener(\"error, stalled\", (event) => {\n      let eventData = getEventData(event.target);\n      postData(createTrackingEvent(\"mediaError\", eventData));\n    });\n  });\n}\n\n// Public variables and functions.\n/**\n * Initialise the click track functionality by hooking to click events\n * @method init\n * @param {string} userid the user id\n * @param {string} irsUrl the URL of the IRS\n * @param {string} irsUser the Username for the IRS auth\n * @param {string} irsPassword the Password for the IRS auth\n */\nexport function init(userid, irsUrl, irsUser, irsPassword) {\n  IRS_URL = irsUrl;\n  IRS_USER = irsUser;\n  IRS_PASSWORD = irsPassword;\n  USERID = userid;\n\n  setTabId();\n  postUserAgent(userid);\n  trackIntersection(userid);\n  trackMouseClick(userid);\n  trackMouseMove(userid);\n  trackTextSelection(userid);\n  trackMouseLeave(userid);\n  trackMouseEnter(userid);\n  trackCopy(userid);\n  postViewport(userid);\n  trackPositionsAndViewport(userid);\n  trackBlur(userid);\n  trackFocus(userid);\n  trackQuizInputChange(userid);\n  trackDetailToggle(userid);\n  trackTabLeave(userid);\n  trackContextMenu(userid);\n  trackResize(userid);\n  trackMediaEvents(userid);\n}"],"file":"tracker.min.js"}